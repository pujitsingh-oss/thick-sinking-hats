<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Submit Pulse â€“ Thick Sinking Hats</title>
    <style>
      body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:24px;max-width:720px;}
      .card{border:1px solid #ddd;border-radius:12px;padding:16px;box-shadow:0 2px 6px rgba(0,0,0,0.05);margin-bottom:12px;}
      label{display:block;margin:8px 0 4px 0;}
      input,select,textarea,button{width:100%;font-size:14px;padding:10px;border-radius:10px;border:1px solid #ccc;box-sizing:border-box;}
      button{cursor:pointer;margin-top:12px;}
      .muted{color:#666}
      .success{background:#e9fce9;border:1px solid #bde5bd;padding:8px;border-radius:8px;margin-top:8px;}
      .error{background:#fdeaea;border:1px solid #f3b4b4;padding:8px;border-radius:8px;margin-top:8px;}
    </style>
  </head>
  <body>
    <h2>Submit Pulse</h2>
    <div class="card">
      <p class="muted">Your feedback helps us spot trends early. Employee ID is optional; leave blank for anonymity in this demo.</p>
      <label>Team</label>
      <select id="team">
        <option>RISK-OPS</option>
        <option>ENG-PLATFORM</option>
        <option>FIN-OPS</option>
        <option>CS-SUPPORT</option>
      </select>

      <label>Rating (1 = low, 5 = high)</label>
      <select id="rating">
        <option>5</option><option>4</option><option>3</option><option>2</option><option>1</option>
      </select>

      <label>Comment (optional)</label>
      <textarea id="comment" rows="4" placeholder="Any context you want to share..."></textarea>

      <label>Employee hash (optional)</label>
      <input id="emp" placeholder="e.g., anonymized emp hash" />

      <button onclick="submitPulse()">Submit</button>
      <div id="msg"></div>
    </div>

    <div class="card">
      <h3>Quick links</h3>
      <p><a href="/pocs/health.html">View Org Pulse Dashboard</a></p>
    </div>

    <script>
      async function submitPulse(){
        const body = {
          team_id: document.getElementById('team').value,
          emp_hash: document.getElementById('emp').value || undefined,
          rating_1to5: Number(document.getElementById('rating').value),
          comment_text: document.getElementById('comment').value
        };
        const res = await fetch('/.netlify/functions/pulse_submit', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });
        const msg = document.getElementById('msg');
        if(res.ok){
          const data = await res.json();
          msg.className = 'success';
          msg.textContent = 'Pulse submitted! Stored in ' + (data.stored || '/tmp/pulses.csv') + '. Refresh the dashboard.';
          document.getElementById('comment').value='';
        } else {
          const text = await res.text();
          msg.className = 'error';
          msg.textContent = 'Error: ' + text;
        }
      }
    </script>
  </body>
</html>
